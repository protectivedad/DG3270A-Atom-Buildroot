#!/bin/sh

#  This file is provided under a dual BSD/GPLv2 license.  When using or 
#  redistributing this file, you may do so under either license.
#
#  GPL LICENSE SUMMARY
#
#  Copyright(c) 2007-2011 Intel Corporation. All rights reserved.
#
#  This program is free software; you can redistribute it and/or modify 
#  it under the terms of version 2 of the GNU General Public License as
#  published by the Free Software Foundation.
#
#  This program is distributed in the hope that it will be useful, but 
#  WITHOUT ANY WARRANTY; without even the implied warranty of 
#  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU 
#  General Public License for more details.
#
#  You should have received a copy of the GNU General Public License 
#  along with this program; if not, write to the Free Software 
#  Foundation, Inc., 51 Franklin St - Fifth Floor, Boston, MA 02110-1301 USA.
#  The full GNU General Public License is included in this distribution 
#  in the file called LICENSE.GPL.
#
#  Contact Information:
#  intel.com
#  Intel Corporation
#  2200 Mission College Blvd.
#  Santa Clara, CA  95052
#  USA
#  (408) 765-8080
#
# =========================================================================

# Script name can be the called name, or something more meaningful.
SCRIPTNAME=$0
PATH=/usr/local/bin:/usr/bin:/bin:/sbin

. /etc/init.d/init_utilities

start_function() {
    # Install modules, make device nodes, start daemons here
    # Start udev
    try_command udevd -d
	#enable trusted group option, customer could define env varible APP_TRUSTED_GROUP_NAME to enable it.
	if [ -n "$APP_TRUSTED_GROUP_NAME" ]; then
		try_command udevadm control --property=EN_TRUSTED=yes --property=TRUSTED_GRP_NAME=$APP_TRUSTED_GROUP_NAME
	fi
    try_command udevadm trigger --action=add
}

stop_function() {
    # Terminate daemons, remove modules, remove device nodes here
    DAEMON_PID=`ps | grep -v grep | grep "udevd" | awk '{print $1}' | head -1`
    if [ "x$DAEMON_PID" != "x" ]; then  
        kill $DAEMON_PID &
    fi
}

case $1 in
    "start")
        start_function
        ;;
    "stop")
        stop_function
        ;;
    "restart")
        stop_function
        start_function
        ;;
    *)
        echo "Usage: $0 {start|stop|restart}"
esac
